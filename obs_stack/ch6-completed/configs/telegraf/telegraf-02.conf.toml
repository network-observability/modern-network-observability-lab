[agent]
  hostname = "telegraf-02"

[[inputs.gnmi]]
  addresses = ["ceos-02:50051"]
  username = "${NETWORK_AGENT_USER}"
  password = "${NETWORK_AGENT_PASSWORD}"
  redial = "20s"
  # Exclude the "path" tag from the output
  tagexclude = ["path"]

  [[inputs.gnmi.subscription]]
    name = "interface"
    path = "/interfaces/interface/state/counters"
    subscription_mode = "sample"
    sample_interval = "10s"

  [[inputs.gnmi.subscription]]
    name = "interface"
    path = "/interfaces/interface/state/oper-status"
    subscription_mode = "sample"
    sample_interval = "10s"

[[processors.rename]]
  # Rename the tag "source" to "device"
  [[processors.rename.replace]]
    tag = "source"
    dest = "device"

# Add a tag "intf_role" based on the interface name
[[processors.regex]]
  # Filter metrics that have the "interface" name
  namepass = ["interface"]

  # Filter metrics that have the "ceos-02" device
  [processors.regex.tagpass]
      device = ["ceos-02"]

  [[processors.regex.tags]]
    # Name of the tag to match
    key = "name"
    # Regex pattern to match
    pattern = "^Ethernet.*$"
    # Name of the new tag
    result_key = "intf_role"
    # Replacement string
    replacement = "peer"

  [[processors.regex.tags]]
    key = "name"
    pattern = "^Management.*$"
    result_key = "intf_role"
    replacement = "mgmt"

[[outputs.file]]
  files = ["stdout"]